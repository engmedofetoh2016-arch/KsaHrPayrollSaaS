<section class="panel">
  <h2>{{ i18n.text('Leave Approvals', '\u0645\u0648\u0627\u0641\u0642\u0627\u062a \u0627\u0644\u0625\u062c\u0627\u0632\u0627\u062a') }}</h2>

  <div class="balance-editor">
    <h3>{{ i18n.text('Adjust Leave Balance', '\u062a\u0639\u062f\u064a\u0644 \u0631\u0635\u064a\u062f \u0627\u0644\u0625\u062c\u0627\u0632\u0629') }}</h3>
    <div class="editor-grid">
      <label>
        {{ i18n.text('Employee', '\u0627\u0644\u0645\u0648\u0638\u0641') }}
        <select [ngModel]="selectedEmployeeId()" (ngModelChange)="selectedEmployeeId.set($event)">
          @for (employee of employees(); track employee.id) {
            <option [value]="employee.id">{{ employee.firstName }} {{ employee.lastName }}</option>
          }
        </select>
      </label>
      <label>
        {{ i18n.text('Year', '\u0627\u0644\u0633\u0646\u0629') }}
        <input type="number" [ngModel]="balanceYear()" (ngModelChange)="balanceYear.set($event)" min="2000" max="2100" />
      </label>
      <label>
        {{ i18n.text('Type', '\u0627\u0644\u0646\u0648\u0639') }}
        <select [ngModel]="balanceLeaveType()" (ngModelChange)="balanceLeaveType.set($event)">
          <option [ngValue]="1">{{ i18n.text('Annual', '\u0633\u0646\u0648\u064a\u0629') }}</option>
          <option [ngValue]="2">{{ i18n.text('Sick', '\u0645\u0631\u0636\u064a\u0629') }}</option>
          <option [ngValue]="3">{{ i18n.text('Unpaid', '\u063a\u064a\u0631 \u0645\u062f\u0641\u0648\u0639\u0629') }}</option>
        </select>
      </label>
      <label>
        {{ i18n.text('Allocated Days', '\u0627\u0644\u0623\u064a\u0627\u0645 \u0627\u0644\u0645\u062e\u0635\u0635\u0629') }}
        <input type="number" [ngModel]="allocatedDays()" (ngModelChange)="allocatedDays.set($event)" min="0" step="0.5" />
      </label>
      <label>
        {{ i18n.text('Used Days', '\u0627\u0644\u0623\u064a\u0627\u0645 \u0627\u0644\u0645\u0633\u062a\u062e\u062f\u0645\u0629') }}
        <input type="number" [ngModel]="usedDays()" (ngModelChange)="usedDays.set($event)" min="0" step="0.5" />
      </label>
      <button type="button" (click)="upsertBalance()" [disabled]="busy()">
        {{ i18n.text('Save Balance', '\u062d\u0641\u0638 \u0627\u0644\u0631\u0635\u064a\u062f') }}
      </button>
    </div>
  </div>

  <div class="actions">
    <button type="button" [class.active]="statusFilter() === 1" (click)="setStatusFilter(1)">{{ i18n.text('Pending', '\u0645\u0639\u0644\u0642') }}</button>
    <button type="button" [class.active]="statusFilter() === 2" (click)="setStatusFilter(2)">{{ i18n.text('Approved', '\u0645\u0639\u062a\u0645\u062f') }}</button>
    <button type="button" [class.active]="statusFilter() === 3" (click)="setStatusFilter(3)">{{ i18n.text('Rejected', '\u0645\u0631\u0641\u0648\u0636') }}</button>
    <button type="button" [class.active]="statusFilter() === 0" (click)="setStatusFilter(0)">{{ i18n.text('All', '\u0627\u0644\u0643\u0644') }}</button>
  </div>

  @if (message()) { <p class="ok">{{ message() }}</p> }
  @if (error()) { <p class="error">{{ error() }}</p> }

  <table>
    <thead>
      <tr>
        <th>{{ i18n.text('Employee', '\u0627\u0644\u0645\u0648\u0638\u0641') }}</th>
        <th>{{ i18n.text('Type', '\u0627\u0644\u0646\u0648\u0639') }}</th>
        <th>{{ i18n.text('Start', '\u0627\u0644\u0628\u062f\u0627\u064a\u0629') }}</th>
        <th>{{ i18n.text('End', '\u0627\u0644\u0646\u0647\u0627\u064a\u0629') }}</th>
        <th>{{ i18n.text('Days', '\u0627\u0644\u0623\u064a\u0627\u0645') }}</th>
        <th>{{ i18n.text('Status', '\u0627\u0644\u062d\u0627\u0644\u0629') }}</th>
        <th>{{ i18n.text('Reason', '\u0627\u0644\u0633\u0628\u0628') }}</th>
        <th>{{ i18n.text('Actions', '\u0627\u0644\u0625\u062c\u0631\u0627\u0621\u0627\u062a') }}</th>
      </tr>
    </thead>
    <tbody>
      @for (request of requests(); track request.id) {
        <tr>
          <td>{{ request.employeeName }}</td>
          <td>{{ leaveTypeLabel(request.leaveType) }}</td>
          <td>{{ request.startDate }}</td>
          <td>{{ request.endDate }}</td>
          <td>{{ request.totalDays | number: '1.0-2' }}</td>
          <td>{{ statusLabel(request.status) }}</td>
          <td>
            {{ request.reason }}
            @if (request.status === 3 && request.rejectionReason) {
              <div class="reject">{{ i18n.text('Rejected:', '\u0645\u0631\u0641\u0648\u0636:') }} {{ request.rejectionReason }}</div>
            } @else if (request.status === 2 && request.rejectionReason) {
              <div class="reject">{{ i18n.text('Review Comment:', '\u062a\u0639\u0644\u064a\u0642 \u0627\u0644\u0645\u0631\u0627\u062c\u0639\u0629:') }} {{ request.rejectionReason }}</div>
            }
          </td>
          <td>
            @if (request.status === 1) {
              <div class="row-actions">
                <button type="button" (click)="approve(request.id)" [disabled]="busy()">{{ i18n.text('Approve', '\u0627\u0639\u062a\u0645\u0627\u062f') }}</button>
                <button type="button" (click)="reject(request.id)" [disabled]="busy()">{{ i18n.text('Reject', '\u0631\u0641\u0636') }}</button>
              </div>
            } @else {
              <span>-</span>
            }
          </td>
        </tr>
      }
    </tbody>
  </table>
</section>
