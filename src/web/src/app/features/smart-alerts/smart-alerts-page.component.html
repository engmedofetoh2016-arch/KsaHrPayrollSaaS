<section class="smart-alerts-page">
  <div class="head">
    <div>
      <h2>{{ i18n.text('Smart Alerts', 'التنبيهات الذكية') }}</h2>
      <p class="meta">{{ i18n.text('Actionable payroll and compliance reminders.', 'تنبيهات عملية للرواتب والامتثال.') }}</p>
    </div>
    <div class="summary">
      <span class="pill critical">{{ i18n.text('Critical', 'حرج') }}: {{ criticalCount() }}</span>
      <span class="pill warning">{{ i18n.text('Warning', 'تحذير') }}: {{ warningCount() }}</span>
      <span class="pill notice">{{ i18n.text('Notice', 'تنبيه') }}: {{ noticeCount() }}</span>
    </div>
  </div>

  <div class="filters">
    <label>
      {{ i18n.text('Look Ahead (days)', 'نطاق الاستباق (أيام)') }}
      <input type="number" min="1" max="120" [(ngModel)]="daysAhead" />
    </label>
    <button type="button" (click)="load()" [disabled]="loading()">
      {{ loading() ? i18n.text('Loading...', 'جارٍ التحميل...') : i18n.text('Refresh', 'تحديث') }}
    </button>
  </div>

  @if (error()) {
    <p class="error">{{ error() }}</p>
  }

  @if (message()) {
    <p class="ok">{{ message() }}</p>
  }

  @if (!loading() && items().length === 0) {
    <p class="meta">{{ i18n.text('No active smart alerts for this horizon.', 'لا توجد تنبيهات ذكية نشطة ضمن هذا النطاق.') }}</p>
  } @else {
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>{{ i18n.text('Severity', 'الأولوية') }}</th>
            <th>{{ i18n.text('Type', 'النوع') }}</th>
            <th>{{ i18n.text('Subject', 'الموضوع') }}</th>
            <th>{{ i18n.text('Message', 'الرسالة') }}</th>
            <th>{{ i18n.text('Due', 'الاستحقاق') }}</th>
            <th>{{ i18n.text('Actions', 'الإجراءات') }}</th>
          </tr>
        </thead>
        <tbody>
          @for (item of items(); track item.key) {
            <tr>
              <td>
                <span class="pill" [class]="severityClass(item.severity)">{{ item.severity }}</span>
              </td>
              <td>{{ item.type }}</td>
              <td>{{ item.subject || '-' }}</td>
              <td>{{ item.message }}</td>
              <td>
                @if (item.dueDate) {
                  {{ item.dueDate | date: 'mediumDate' }}
                  @if (item.daysLeft !== undefined && item.daysLeft !== null) {
                    ({{ item.daysLeft }})
                  }
                } @else {
                  -
                }
              </td>
              <td class="row-actions">
                <button type="button" (click)="acknowledge(item.key)" [disabled]="!!actionKey()">
                  {{ i18n.text('Acknowledge', 'تأكيد') }}
                </button>
                <button type="button" (click)="snooze(item.key, 7)" [disabled]="!!actionKey()">
                  {{ i18n.text('Snooze 7d', 'تأجيل 7 أيام') }}
                </button>
                <button type="button" (click)="snooze(item.key, 30)" [disabled]="!!actionKey()">
                  {{ i18n.text('Snooze 30d', 'تأجيل 30 يومًا') }}
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</section>
