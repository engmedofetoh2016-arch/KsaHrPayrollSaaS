<section class="smart-alerts-page">
  <div class="head">
    <div>
      <h2>Smart Alerts</h2>
      <p class="meta">Actionable payroll and compliance reminders.</p>
    </div>
    <div class="summary">
      <span class="pill critical">Critical: {{ criticalCount() }}</span>
      <span class="pill warning">Warning: {{ warningCount() }}</span>
      <span class="pill notice">Notice: {{ noticeCount() }}</span>
    </div>
  </div>

  <div class="filters">
    <label>
      Look Ahead (days)
      <input type="number" min="1" max="120" [(ngModel)]="daysAhead" />
    </label>
    <button type="button" (click)="load()" [disabled]="loading()">
      {{ loading() ? 'Loading...' : 'Refresh' }}
    </button>
  </div>

  @if (error()) {
    <p class="error">{{ error() }}</p>
  }

  @if (message()) {
    <p class="ok">{{ message() }}</p>
  }

  @if (!loading() && items().length === 0) {
    <p class="meta">No active smart alerts for this horizon.</p>
  } @else {
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Severity</th>
            <th>Type</th>
            <th>Subject</th>
            <th>Message</th>
            <th>Due</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (item of items(); track item.key) {
            <tr>
              <td>
                <span class="pill" [class]="severityClass(item.severity)">{{ item.severity }}</span>
              </td>
              <td>{{ item.type }}</td>
              <td>{{ item.subject || '-' }}</td>
              <td>{{ item.message }}</td>
              <td>
                @if (item.dueDate) {
                  {{ item.dueDate | date: 'mediumDate' }}
                  @if (item.daysLeft !== undefined && item.daysLeft !== null) {
                    ({{ item.daysLeft }})
                  }
                } @else {
                  -
                }
              </td>
              <td class="row-actions">
                <button type="button" (click)="acknowledge(item.key)" [disabled]="!!actionKey()">
                  Acknowledge
                </button>
                <button type="button" (click)="snooze(item.key, 7)" [disabled]="!!actionKey()">
                  Snooze 7d
                </button>
                <button type="button" (click)="snooze(item.key, 30)" [disabled]="!!actionKey()">
                  Snooze 30d
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</section>
